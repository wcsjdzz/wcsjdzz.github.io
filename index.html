<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Blooooog~ - 你所不知道的老杜振熙之技术博客</title><meta name="author" content="老杜振熙"><meta name="copyright" content="老杜振熙"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="或许在此处可以找到你我想要的东西">
<meta property="og:type" content="website">
<meta property="og:title" content="Blooooog~">
<meta property="og:url" content="https://wcsjdzz.github.io/index.html">
<meta property="og:site_name" content="Blooooog~">
<meta property="og:description" content="或许在此处可以找到你我想要的东西">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wcsjdzz.github.io/null">
<meta property="article:author" content="老杜振熙">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wcsjdzz.github.io/null"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://wcsjdzz.github.io/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: true,
  isToc: false,
  postUpdate: '2020-12-14 05:11:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div></div><hr/></div></div><div id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Blooooog~</a></span><span id="menus"><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="site-info"><h1 id="site-title">Blooooog~</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/14/%E5%AE%9E%E7%8E%B0TCP%E7%BD%91%E7%BB%9C%E5%BA%93%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%BA%E5%88%B6/" title="实现TCP网络库的多线程机制">     <img class="post_bg" src="/2020/12/14/%E5%AE%9E%E7%8E%B0TCP%E7%BD%91%E7%BB%9C%E5%BA%93%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%BA%E5%88%B6/final.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实现TCP网络库的多线程机制"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/14/%E5%AE%9E%E7%8E%B0TCP%E7%BD%91%E7%BB%9C%E5%BA%93%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%BA%E5%88%B6/" title="实现TCP网络库的多线程机制">实现TCP网络库的多线程机制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-14T12:57:21.000Z" title="发表于 2020-12-14 04:57:21">2020-12-14</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/C-net-programming/">C++ net programming</a></span></div><div class="content">如何实现一个网络库的多线程机制？实际上，并不需要各种繁杂的锁机制。先用一句话来阐述核心思想：以函数执行线程的转移作为实现线程安全的机制。具体来说，分为如下几点：

one loop per thread : 其中的每个线程均和一个独立的 EventLoop 关联
EventLoopThreadPool : 线程池，从池中取出一个新的线程，等价于取出一个新的 EventLoop
线程安全性 : 通过EventLoop::runInLoop()函数，使得函数的执行能够在线程间进行转移
线程切换：整个流程中，线程切换仅发生在 Connection 建立和 Connection 删除这两个步骤中，其余的阶段都为单线程执行
新建 Connection：Server 所在线程负责新建连接，随后利用EventLoop::runInLoop()将新连接的控制权转移到线程池中的 IO 线程；
删除 Connection：由于 Server 中保存有 Connection 的副本，因此需要将删除 Connection 的操作转移到 Server 所在线程，方式还是利用EventLoop::runInLoo ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/12/%E7%90%86%E8%A7%A3condition-variable/" title="理解condition_variable">     <img class="post_bg" src="/2020/12/12/%E7%90%86%E8%A7%A3condition-variable/final.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="理解condition_variable"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/12/%E7%90%86%E8%A7%A3condition-variable/" title="理解condition_variable">理解condition_variable</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-12T11:53:00.000Z" title="发表于 2020-12-12 03:53:00">2020-12-12</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/C-net-programming/">C++ net programming</a></span></div><div class="content">C++标准库中的底层同步原语。理解std::condition_variable，着重就在于理解std::condition_variable::wait()这个函数，签名为void(std::unique_lock&lt;std::mutex&gt;&amp; lk, Predicate pred)，Predicate代表谓词。

wait 的作用一句话解释：阻塞当前线程，直至被其他线程通过notify_all()或者notify_one()唤醒，并且满足谓词条件。notify*()也是std::condition_variable的成员函数。
如何调用线程在调用`wait()`之前必须先获得锁，也就是说，必须是如下所示配套的调用：
12345std::condition_variable cv;std::mutex mutex_;std::unique_lock&lt;std::mutex&gt; lk(mutex_); // 争取获得锁cond.wait(lk, []&#123;/*谓词*/&#125;); // OK, 已经获得锁了，可以开始wait

内部流程如图 1 所示。 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/09/mysql-grammer-summary/" title="mysql-grammer-summary">     <img class="post_bg" src="/img/doc-cover.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mysql-grammer-summary"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/09/mysql-grammer-summary/" title="mysql-grammer-summary">mysql-grammer-summary</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-09T12:33:49.000Z" title="发表于 2020-12-09 04:33:49">2020-12-09</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/MYSQL/">MYSQL</a></span></div><div class="content">formeruse &lt;database&gt; : 选择某个数据库测试: 不加 FROM 字段可以测试 mysql 的各个功能
常用的 SHOW 命令SHOW DATABASES:SHOW TABLES:SHOW COLUMNS FROM &lt;TABLE&gt; 等价于 DESCRIBE &lt;TABLE&gt;SHOW GRANTS
常用的 SELECT 命令SELECT &lt;COLUMNS&gt; FROM &lt;TABLE&gt; : 从表中选出某一列（整列）SELECT DISTINCT &lt;COLUMNS&gt; FROM &lt;TABLE&gt; : 从表中选出某一整列，但剔除掉重复的行SELECT &lt;COLUMNS&gt; FROM &lt;TABLE&gt; LIMIT &lt;row, lines&gt; : 选出从第 row 行开始的 lines 行SELECT &lt;TABLES&gt;.&lt;COLUMNS&gt; FROM &lt;DATABASE&gt;.&lt;TABLE&gt; : 限定 scope（相当于 namesp ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/08/%E5%90%91%E9%87%8FIO-%E2%80%94%E2%80%94-muduo%E7%BD%91%E7%BB%9C%E5%BA%93Buffer%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E6%80%BB%E7%BB%93/" title="向量IO —— muduo网络库Buffer设计理念总结">     <img class="post_bg" src="/img/doc-cover.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="向量IO —— muduo网络库Buffer设计理念总结"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/08/%E5%90%91%E9%87%8FIO-%E2%80%94%E2%80%94-muduo%E7%BD%91%E7%BB%9C%E5%BA%93Buffer%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E6%80%BB%E7%BB%93/" title="向量IO —— muduo网络库Buffer设计理念总结">向量IO —— muduo网络库Buffer设计理念总结</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-08T13:54:52.000Z" title="发表于 2020-12-08 05:54:52">2020-12-08</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/C-net-programming/">C++ net programming</a></span></div><div class="content">注：本文为阅读 muduo 网络库源码 Buffer 部分的体悟
本文中 Buffer 一词均指代 muduo 网络库的 class Buffer。
为非阻塞网络库设计一个合理的缓冲区机制是很重要的一环1。muduo 网络库源码中的 Buffer 部分中，我觉得最能体现精华的就是关于设计缓冲区大小这一部分，其核心就是下方所贴出的ssize_t Buffer::readFd(int fd, int *savedErrno)函数，其作用是读取fd指示的对端发来的数据，并保存于内部的vector&lt;char&gt; buf_变量中。下面就是对这一函数体现的设计思路的解析。
如何为每个 TCP 连接分配合理大小的缓冲区呢？如果太大，那么当 TCP 连接数增多之后，内存必然负担过大；而如果过小，那么会增加系统调用(::read(), ::write())的次数，时间开销陡增。作者给出的方案很巧妙，即使用分散/聚集 IO，也称为向量 IO。
初始时，Buffer 的内置缓冲vector&lt;char&gt; buf_的初始大小其实很小，在源码中仅设置为 1K 字节。但在进行::readv() ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/07/TcpConnection%E2%80%94%E2%80%94%E6%AD%A3%E7%A1%AE%E8%BF%9B%E8%A1%8C%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%9A%84%E5%85%B3%E9%94%AE/" title="TcpConnection——正确进行资源管理的关键">     <img class="post_bg" src="/2020/12/07/TcpConnection%E2%80%94%E2%80%94%E6%AD%A3%E7%A1%AE%E8%BF%9B%E8%A1%8C%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%9A%84%E5%85%B3%E9%94%AE/pic1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TcpConnection——正确进行资源管理的关键"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/07/TcpConnection%E2%80%94%E2%80%94%E6%AD%A3%E7%A1%AE%E8%BF%9B%E8%A1%8C%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%9A%84%E5%85%B3%E9%94%AE/" title="TcpConnection——正确进行资源管理的关键">TcpConnection——正确进行资源管理的关键</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-07T13:16:31.000Z" title="发表于 2020-12-07 05:16:31">2020-12-07</time></span></div><div class="content">注：本文为研究 muduo 源码库之后的理解和代码实战
TcpServerTcpConnection 和 TcpServer 是紧密相连的，因为 connection 就是由 server 进行创建得到。因此，在阐述 TcpConnection 的实现细节之前，我们先思考一下 TcpServer 的一些重点。

TcpServer 是 Acceptor 的唯一使用者在之前关于 Acceptor 的文章之中，我们已经阐述了 Acceptor 的详细细节和原理。TcpServer 是 Acceptor 的唯一使用者，或者说是唯一拥有者。Acceptor 在探测到连接请求并使用::accept()成功创建了对端 socket 和网络地址之后，执行的 user callback 就是来自 TcpServer 的 callback。Acceptor 仅为 TcpServer 服务。

callback 的具体流程思考一下 TcpServer 在收到了对端 socket 和网络地址之后，应该做些什么。其实很简单，一句话概括便是：创建对应 TcpConnection，并在其中注册网络库实际用户的回调 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/06/TimerQueue%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8Etimer-fd%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8%E6%9C%BA%E5%88%B6/" title="TimerQueue——基于timer fd的定时器机制">     <img class="post_bg" src="/2020/12/06/TimerQueue%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8Etimer-fd%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8%E6%9C%BA%E5%88%B6/pic1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TimerQueue——基于timer fd的定时器机制"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/06/TimerQueue%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8Etimer-fd%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8%E6%9C%BA%E5%88%B6/" title="TimerQueue——基于timer fd的定时器机制">TimerQueue——基于timer fd的定时器机制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-06T13:52:00.000Z" title="发表于 2020-12-06 05:52:00">2020-12-06</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/C-net-programming/">C++ net programming</a></span></div><div class="content">注：本文为阅读 muduo 源码库和作者著作之后的网络库复现和笔记
在传统的 IO 多路复用系统中，定时操作通常是直接去设置poll()等函数的超时时间，系统超时之后去执行对应的定时回调。但现代 Linux 系统已经将时间也抽象为了一种事件，并提供了对应的文件描述符fd机制，其能够被poll()等多路复用函数进行监视，因此可以很简洁地融入到我们之前实现的 Reactor 机制中。这也是更科学的做法。
底层 API
int timerfd_create(int clockid, int flags)根据用户指定的标识符生成 timer，并返回对应的fd。clockid设置时钟的类型，flags则是设置fd的各个标志位，比如是否阻塞等等。

int timerfd_settime(int fd, int flags, const struct itimerspec *new_value, struct itimerspec *old_value)通过new_value去设定 timer 的超时时间（expiration time）以及是否重复（repeat via same iterval ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/06/%E4%BD%BF%E7%94%A8C-%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84Reactor%E6%A8%A1%E5%BC%8F/" title="使用C++实现简单的Reactor模式">     <img class="post_bg" src="/2020/12/06/%E4%BD%BF%E7%94%A8C-%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84Reactor%E6%A8%A1%E5%BC%8F/pic2.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用C++实现简单的Reactor模式"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/06/%E4%BD%BF%E7%94%A8C-%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84Reactor%E6%A8%A1%E5%BC%8F/" title="使用C++实现简单的Reactor模式">使用C++实现简单的Reactor模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-06T10:58:30.000Z" title="发表于 2020-12-06 02:58:30">2020-12-06</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/C-net-programming/">C++ net programming</a></span></div><div class="content">注：本文是阅读 muduo 网络库之后的理解以及自己的代码实现
IO 多路复用是 Reactor 的核心，简单来说，我们将多个文件描述符存放于一个统一的框架之中进行管理，每当某一个文件描述符中发生了某个事件，系统就去执行对应的响应函数，这也被称为回调。如图 1 所示是 Reactor 的流程描述，fd_2变为红色代表着该文件描述符当前存在激活事件，系统将其推入Event Callback Trigger的卡槽中，代表着fd_2的开关开启，系统开始执行对应的回调函数。
实现一个 Reactor 模式需要将其中的几个核心部件进行拆分。
首先，我们知道，对于对象，它们都拥有自己的回调函数，而对象本身，在 Linux 中可以用文件描述符进行表示，这包括但不限于各类文件资源、标准输入输出、SOCKET 通信甚至是定时器。综上，对于这一块，我们使用一个class Channel对一个文件描述符和它对应的回调函数进行封装，这在图 1 中对应了各个橙色的小卡片。
其次，整个系统应该有一个最上层的抽象描述。所谓抽象描述，是我们不去关心具体的实现，而是需要描述出这整个系统的核心特点。在这里，虽然是 IO  ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/05/Acceptor%E2%80%94%E2%80%94%E5%B0%81%E8%A3%85socket%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%B9%B6%E9%9B%86%E6%88%90%E5%88%B0Reactor%E6%A1%86%E6%9E%B6%E4%B8%AD/" title="Acceptor——封装socket系统调用并集成到Reactor框架中">     <img class="post_bg" src="/2020/12/05/Acceptor%E2%80%94%E2%80%94%E5%B0%81%E8%A3%85socket%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%B9%B6%E9%9B%86%E6%88%90%E5%88%B0Reactor%E6%A1%86%E6%9E%B6%E4%B8%AD/Acceptor_final.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Acceptor——封装socket系统调用并集成到Reactor框架中"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/05/Acceptor%E2%80%94%E2%80%94%E5%B0%81%E8%A3%85socket%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%B9%B6%E9%9B%86%E6%88%90%E5%88%B0Reactor%E6%A1%86%E6%9E%B6%E4%B8%AD/" title="Acceptor——封装socket系统调用并集成到Reactor框架中">Acceptor——封装socket系统调用并集成到Reactor框架中</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-06T07:01:26.000Z" title="发表于 2020-12-05 23:01:26">2020-12-05</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/C-net-programming/">C++ net programming</a></span></div><div class="content">注：本文为阅读了 muduo 网络库源码及作者著作之后对于网络库的复现和笔记
功能我们定义一个class Acceptor，其功能是：让服务器在指定的端口处进行监听，如果在端口监听到连接，则执行由class Acceptor的类用户注册的回调函数。
底层 API首先梳理一下与 Acceptor 相关的底层 API 调用。

int socket(int domain, int type, int protocol)用于创建本地 socket fd，domain指示网络的通信所在域，通常选择AF_INET即可，代表 IPV4；type指示 socket fd 类型，对于 TCP 协议，因为是流式协议，加上我们的网络库的非阻塞特性，而通常还需指定 CLOSE ON EXECVE，所以通常需要输入SOCK_STREAM | SOCK_NONBLOCK | SOCK_CLOEXEC；protocol指示具体协议，这里我们选用IPPROTO_TCP

int bind(int sockfd, const struct sockaddr *addr, socklen_t addrLen)用于将so ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/05/hello-world/" title="Hello World">     <img class="post_bg" src="/img/doc-cover.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/05/hello-world/" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-06T04:44:23.457Z" title="发表于 2020-12-05 20:44:23">2020-12-05</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment
</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/null" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">老杜振熙</div><div class="author-info__description">或许在此处可以找到你我想要的东西</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wcsjdzz"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">Hello, hope it won't waste your time.</div></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2020/12/14/%E5%AE%9E%E7%8E%B0TCP%E7%BD%91%E7%BB%9C%E5%BA%93%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%BA%E5%88%B6/" title="实现TCP网络库的多线程机制"><img src="/2020/12/14/%E5%AE%9E%E7%8E%B0TCP%E7%BD%91%E7%BB%9C%E5%BA%93%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%BA%E5%88%B6/final.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实现TCP网络库的多线程机制"/></a><div class="content"><a class="title" href="/2020/12/14/%E5%AE%9E%E7%8E%B0TCP%E7%BD%91%E7%BB%9C%E5%BA%93%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%9C%BA%E5%88%B6/" title="实现TCP网络库的多线程机制">实现TCP网络库的多线程机制</a><time datetime="2020-12-14T12:57:21.000Z" title="发表于 2020-12-14 04:57:21">2020-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/12/%E7%90%86%E8%A7%A3condition-variable/" title="理解condition_variable"><img src="/2020/12/12/%E7%90%86%E8%A7%A3condition-variable/final.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="理解condition_variable"/></a><div class="content"><a class="title" href="/2020/12/12/%E7%90%86%E8%A7%A3condition-variable/" title="理解condition_variable">理解condition_variable</a><time datetime="2020-12-12T11:53:00.000Z" title="发表于 2020-12-12 03:53:00">2020-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/09/mysql-grammer-summary/" title="mysql-grammer-summary"><img src="/img/doc-cover.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mysql-grammer-summary"/></a><div class="content"><a class="title" href="/2020/12/09/mysql-grammer-summary/" title="mysql-grammer-summary">mysql-grammer-summary</a><time datetime="2020-12-09T12:33:49.000Z" title="发表于 2020-12-09 04:33:49">2020-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/08/%E5%90%91%E9%87%8FIO-%E2%80%94%E2%80%94-muduo%E7%BD%91%E7%BB%9C%E5%BA%93Buffer%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E6%80%BB%E7%BB%93/" title="向量IO —— muduo网络库Buffer设计理念总结"><img src="/img/doc-cover.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="向量IO —— muduo网络库Buffer设计理念总结"/></a><div class="content"><a class="title" href="/2020/12/08/%E5%90%91%E9%87%8FIO-%E2%80%94%E2%80%94-muduo%E7%BD%91%E7%BB%9C%E5%BA%93Buffer%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E6%80%BB%E7%BB%93/" title="向量IO —— muduo网络库Buffer设计理念总结">向量IO —— muduo网络库Buffer设计理念总结</a><time datetime="2020-12-08T13:54:52.000Z" title="发表于 2020-12-08 05:54:52">2020-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/07/TcpConnection%E2%80%94%E2%80%94%E6%AD%A3%E7%A1%AE%E8%BF%9B%E8%A1%8C%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%9A%84%E5%85%B3%E9%94%AE/" title="TcpConnection——正确进行资源管理的关键"><img src="/2020/12/07/TcpConnection%E2%80%94%E2%80%94%E6%AD%A3%E7%A1%AE%E8%BF%9B%E8%A1%8C%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%9A%84%E5%85%B3%E9%94%AE/pic1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TcpConnection——正确进行资源管理的关键"/></a><div class="content"><a class="title" href="/2020/12/07/TcpConnection%E2%80%94%E2%80%94%E6%AD%A3%E7%A1%AE%E8%BF%9B%E8%A1%8C%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%9A%84%E5%85%B3%E9%94%AE/" title="TcpConnection——正确进行资源管理的关键">TcpConnection——正确进行资源管理的关键</a><time datetime="2020-12-07T13:16:31.000Z" title="发表于 2020-12-07 05:16:31">2020-12-07</time></div></div></div></div></div><div class="card-widget card-categories"><div class="card-content"><div class="item-headline"><i class="fas fa-folder-open"></i><span>分类</span></div><ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C-net-programming/"><span class="card-category-list-name">C++ net programming</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MYSQL/"><span class="card-category-list-name">MYSQL</span><span class="card-category-list-count">1</span></a></li>
            
            </ul></div></div><div class="card-widget card-archives"><div class="card-content"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/12/"><span class="card-archive-list-date">十二月 2020</span><span class="card-archive-list-count">9</span></a></li></ul></div></div><div class="card-widget card-webinfo"><div class="card-content"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">9</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2020-12-14T13:11:02.323Z"></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 By 老杜振熙</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>